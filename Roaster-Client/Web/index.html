<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
</head>
<body>

    <p>Hold temperature</p>
    <input type="text" id="holdTemperature" type="number" value="100" />
    
    <button id="holdOn">Hold On</button>
    <button id="holdOff">Hold Off</button>

    <br />
    <textarea id="roastProfile" rows="10" cols="50"></textarea>
    <button id="profileRun">Run Profile</button>
    <button id="profileStop">Stop Profile</button>

    <button id="GetCurrentLog">Write Current Log to Console</button>
    <button id="FirstCrack">Mark First Crack</button>
    <button id="SecondCrack">Mark Second Crack</button>

    <pre id="roasterStatus"></pre>

    <script src="Scripts/jquery-2.2.4.min.js"></script>
    <script type="text/javascript">
        var ip = location.host.substring(0, location.host.indexOf(":"))
        var apiHost = "http://" + ip + ":9900/";
        $("#holdOff").hide();
        $("#profileStop").hide();

        $("#holdOn").click(function () {
            var holdTemperature = $("#holdTemperature").val();

            $.get(apiHost + "api/Roaster/HoldTemperature/On/" + holdTemperature);
        });

        $("#holdOff").click(function () {
            var holdTemperature = $("holdTemperature").val();

            $.get(apiHost + "api/Roaster/HoldTemperature/Off");
        });

        $("#profileRun").click(function () {
            var roastProfile = $("#roastProfile").val();
            $.get(apiHost + "api/Profile/Run/" + roastProfile);
        });

        $("#profileStop").click(function () {
            $.get(apiHost + "api/Profile/Stop")
        });

        $("#GetCurrentLog").click(function () {
            $.get(apiHost + "api/Log/GetCurrentLog", function (data) {
                console.log(data);
            });
        });

        $("#FirstCrack").click(function () {
            $.get(apiHost + "api/Log/SetFirstCrack");
        });

        $("#SecondCrack").click(function () {
            $.get(apiHost + "api/Log/SetSecondCrack");
        });

        
        var prevHoldTemperature = 100;
        var prevRoastProfile;
        window.setInterval(function () {
            $.get(apiHost + 'api/Roaster/Status/Get', function (data) {
                $("#roasterStatus").text(JSON.stringify(data, null, 2));

                // Update view with data from server
                if (prevHoldTemperature != data.CurrentHoldTemperature) {
                    $("#holdTemperature").val(data.CurrentHoldTemperature);
                    prevHoldTemperature = data.CurrentHoldTemperature;
                }
                if (prevRoastProfile !== JSON.stringify(data.RoastProfile))
                {
                    $("#roastProfile").val(JSON.stringify(data.RoastProfile, null, 2));
                    prevRoastProfile = JSON.stringify(data.RoastProfile);
                }
                
                if (data.IsHoldOn)
                {
                    $("#holdOn").hide();
                    $("#holdOff").show();
                }
                else
                {
                    $("#holdOn").show();
                    $("#holdOff").hide();
                }

                if (data.IsProfileRunning) {
                    $("#profileRun").hide();
                    $("#profileStop").show();
                }
                else {
                    $("#profileRun").show();
                    $("#profileStop").hide();
                }
            });
        }, 1000);
    </script>
</body>
</html>